{"DefectWeakness":{"ClassType":"_DAT","Cause":{"Type":"Code Defect","Name":"Erroneous Code","Comment":"in \u0027do_i2c_md()\u0027"},"Operation":{"Name":"Declare","Comment":"int object"},"Consequence":{"Type":"Type","Name":"Wrong Type","Comment":"\u0027nbytes\u0027"},"WeaknessAttributes":{"OperationAttribute":{},"OperandAttribute":[{},{}]},"Language":"C","File":"https://github.com/u-boot/u-boot/blob/b75fd37037bcca8a5e86f1648e8fb4e97cba345a/cmd/i2c.c#L473","Trace":"","Line":"473","Class":"DCL"},"Weakness":[{"ClassType":"_DAT","Cause":{"Type":"Type","Name":"Wrong Type","Comment":"in \u0027nbytes = length\u0027"},"Operation":{"Name":"Coerce","Comment":null},"Consequence":{"Type":"Data","Name":"Flipped Sign","Comment":"\u0027length\u0027"},"WeaknessAttributes":{"OperationAttribute":{},"OperandAttribute":[{},{},{}]},"Language":"C","File":"https://github.com/u-boot/u-boot/blob/b75fd37037bcca8a5e86f1648e8fb4e97cba345a/cmd/i2c.c#L531","Trace":"","Line":"531","Class":"TCV"},{"ClassType":"_DAT","Cause":{"Type":"Data","Name":"Wrong Argument","Comment":"in \u0027linebytes = (nbytes \u003E DISP_LINE_LEN) ? DISP_LINE_LEN : nbytes\u0027"},"Operation":{"Name":"Evaluate","Comment":"\u003E"},"Consequence":{"Type":"Data","Name":"Under Range","Comment":"negative \u0027linebytes\u0027 instead of 16"},"WeaknessAttributes":{"OperationAttribute":{},"OperandAttribute":[{},{},{}]},"Language":"C","File":"https://github.com/u-boot/u-boot/blob/b75fd37037bcca8a5e86f1648e8fb4e97cba345a/cmd/i2c.c#L536","Trace":"","Line":"536","Class":"TCM"},{"ClassType":"_DAT","Cause":{"Type":"Data","Name":"Under Range","Comment":"in \u0027nx_i2c_read(uint len)\u0027"},"Operation":{"Name":"Coerce","Comment":"negative \u0027len\u0027"},"Consequence":{"Type":"Data","Name":"Flipped Sign","Comment":"unsigned \u0027len\u0027"},"WeaknessAttributes":{"OperationAttribute":{},"OperandAttribute":[{},{},{}]},"Language":"C","File":"https://github.com/u-boot/u-boot/blob/b75fd37037bcca8a5e86f1648e8fb4e97cba345a/drivers/i2c/nx_i2c.c#L472-L473","Trace":"","Line":"472, 473","Class":"TCV"},{"ClassType":"_DAT","Cause":{"Type":"Data","Name":"Flipped Sign","Comment":"in \u0027i2c_transfer()\u0027"},"Operation":{"Name":"Coerce","Comment":"unsigned \u0027len\u0027"},"Consequence":{"Type":"Data","Name":"Truncated Value","Comment":"large int \u0027len\u0027"},"WeaknessAttributes":{"OperationAttribute":{},"OperandAttribute":[{},{},{}]},"Language":"C","File":"https://github.com/u-boot/u-boot/blob/b75fd37037bcca8a5e86f1648e8fb4e97cba345a/drivers/i2c/nx_i2c.c#L498-L499","Trace":"","Line":"498-499","Class":"TCV"},{"ClassType":"_MEM","Cause":{"Type":"Data","Name":"Wrong Size","Comment":"in \u0027data[i\u002B\u002B] = readb(\u0026i2c-\u003Eiicds);\u0027"},"Operation":{"Name":"Reposition","Comment":"pointer"},"Consequence":{"Type":"Address","Name":"Over Bounds Pointer","Comment":"\u0027i\u0027"},"WeaknessAttributes":{"OperationAttribute":{},"OperandAttribute":[{},{}]},"Language":"C","File":"https://github.com/u-boot/u-boot/blob/b75fd37037bcca8a5e86f1648e8fb4e97cba345a/drivers/i2c/nx_i2c.c#L449","Trace":"","Line":"449","Class":"MAD"},{"ClassType":"_MEM","Cause":{"Type":"Address","Name":"Over Bounds Pointer","Comment":"in \u0027data[i\u002B\u002B] = readb(\u0026i2c-\u003Eiicds);\u0027"},"Operation":{"Name":"Write","Comment":"object"},"Consequence":{"Type":"Memory Corruption/Disclosure","Name":"Buffer Overflow","Comment":"\u0027data[i\u002B\u002B] \u0027"},"WeaknessAttributes":{"OperationAttribute":{},"OperandAttribute":[{},{}]},"Language":"C","File":"https://github.com/u-boot/u-boot/blob/b75fd37037bcca8a5e86f1648e8fb4e97cba345a/drivers/i2c/nx_i2c.c#L449","Trace":"","Line":"449","Class":"MUS"}],"Failure":{"ClassType":"_FLR","Cause":{"Type":"Memory Corruption/Disclosure","Name":"Buffer Overflow","Comment":null},"Failure":[{"FailureAttributes":null,"Class":"ACE"},{"FailureAttributes":null,"Class":"DOS"}]},"ID":"CVE-2022-34835","Title":"Stack Buffer Overflow in Das U-Boot through 2022.07-rc5","Description":"Erroneous declaration of \u2018nbytes\u2019 as int leads to wrong argument type for the uint \u2018length\u2019 in \u2018nbytes = length\u2019, leading to a flipped sign, and under range negative \u2018linebytes\u2019, flipped and truncated to a large integer, allowing pointer reposition over bounds, which, when used in i2c_transfer() leads to stack buffer overflow. If exploited, this can lead to denial of service \u2013 program crash, and possibly arbitrary code execution.\r\n\r\n//generated//\r\nErroneous Code in \u0027do_i2c_md()\u0027 to Simple Declare int object in Codebase u-boot/cmd/i2c.c:473 leads to Wrong Type \u0027nbytes\u0027\r\n\r\n, which propagates to Wrong Type in \u0027nbytes = length\u0027 Pass Out   Coerce in Codebase u-boot/cmd/i2c.c:531 resulting in   Flipped Sign \u0027length\u0027\r\n\r\n, which propagates to Wrong Argument in \u0027linebytes = (nbytes \u003E DISP_LINE_LEN) ? DISP_LINE_LEN : nbytes\u0027 Operator \u003E  Evaluate in Codebase u-boot/cmd/i2c.c:536 resulting in   Under Range negative \u0027linebytes\u0027 instead of 16\r\n\r\n, which propagates to Under Range in \u0027nx_i2c_read(uint len)\u0027 Pass In negative \u0027len\u0027  Coerce in Codebase u-boot/drivers/i2c/nx_i2c.c:472-473 resulting in   Flipped Sign unsigned \u0027len\u0027\r\n\r\n, which propagates to Flipped Sign in \u0027i2c_transfer()\u0027 Pass In unsigned \u0027len\u0027  Coerce in Codebase u-boot/drivers/i2c/nx_i2c.c:498-L499 resulting in   Truncated Value large int \u0027len\u0027\r\n\r\n, which propagates to Wrong Size in \u0027data[i\u002B\u002B] = readb(\u0026i2c-\u003Eiicds);\u0027 Sequential pointer  Reposition in Codebase u-boot/drivers/i2c/nx_i2c.c:499 resulting in  Stack Over Bounds Pointer \u0027i\u0027\r\n\r\n, which propagates to Over Bounds Pointer in \u0027data[i\u002B\u002B] = readb(\u0026i2c-\u003Eiicds);\u0027 Sequential object  Write in Codebase u-boot/drivers/i2c/nx_i2c.c:449 resulting in  Stack Buffer Overflow \u0027data[i\u002B\u002B] \u0027\r\n\r\n. If exploited this can lead to ACE or DOS.","Author":"Irena Bojanova, Eduard Pinconschi","Date":"2023-10-13T14:00:14","Score":"7.5","Criteria":"denx:u-boot","BugReport":"https://lists.denx.de/pipermail/u-boot/2022-June/486113.html","CodeWithBug":"https://source.denx.de/u-boot/u-boot/-/commit/8f8c04bf1ebbd2f72f1643e7ad9617dafa6e5409","CodeWithFix":"https://github.com/u-boot/u-boot/commit/8f8c04bf1ebbd2f72f1643e7ad9617dafa6e5409","CommitId":"8f8c04b"}